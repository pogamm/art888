<!DOCTYPE html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>Health Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body {
      font-family: sans-serif;
      margin: 0;
      padding: 16px;
      background: #f5f5f5;
    }
    canvas {
      background: white;
      border-radius: 12px;
      padding: 12px;
    }
    #summary {
      background: white;
      margin-top: 16px;
      padding: 16px;
      border-radius: 12px;
      font-size: 16px;
    }
  </style>
</head>

<body>

  <canvas id="healthChart" height="200"></canvas>

  <div id="summary">
    ‡∏£‡∏≠‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å‡πÅ‡∏≠‡∏õ...
  </div>

  <script>
    let chart;

    function analyze(label, value) {
      if (value >= 7) return `${label}: ‡∏î‡∏µ‡∏°‡∏≤‡∏Å üëç`;
      if (value >= 4) return `${label}: ‡∏õ‡∏≤‡∏ô‡∏Å‡∏•‡∏≤‡∏á üôÇ`;
      return `${label}: ‡∏Ñ‡∏ß‡∏£‡∏î‡∏π‡πÅ‡∏•‡πÄ‡∏û‡∏¥‡πà‡∏° ‚ö†Ô∏è`;
    }

    function receiveFromThunkable(message) {
      const data = JSON.parse(message);

      const values = [
        data.energy,
        data.mind,
        data.focus,
        data.life,
        data.total
      ];

      const labels = ["Energy", "Mind", "Focus", "Life", "Total"];

      // ====== ‡∏ß‡∏≤‡∏î‡∏Å‡∏£‡∏≤‡∏ü ======
      if (chart) chart.destroy();

      chart = new Chart(document.getElementById("healthChart"), {
        type: "bar",
        data: {
          labels,
          datasets: [{
            label: "‡∏Ñ‡∏∞‡πÅ‡∏ô‡∏ô‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏ß‡∏∞",
            data: values,
            backgroundColor: [
              "#4e79a7",
              "#e15759",
              "#f1ce63",
              "#59a14f",
              "#ff9d00"
            ]
          }]
        },
        options: {
          scales: {
            y: {
              min: 0,
              max: 40
            }
          }
        }
      });

      // ====== ‡∏™‡∏£‡∏∏‡∏õ‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏° ======
      document.getElementById("summary").innerHTML = `
        <b>‡∏™‡∏£‡∏∏‡∏õ‡∏≠‡∏±‡∏ï‡πÇ‡∏ô‡∏°‡∏±‡∏ï‡∏¥</b><br><br>
        ${analyze("‡∏û‡∏•‡∏±‡∏á‡∏á‡∏≤‡∏ô", data.energy)}<br>
        ${analyze("‡∏à‡∏¥‡∏ï‡πÉ‡∏à", data.mind)}<br>
        ${analyze("‡∏™‡∏°‡∏≤‡∏ò‡∏¥", data.focus)}<br>
        ${analyze("‡∏ä‡∏µ‡∏ß‡∏¥‡∏ï", data.life)}<br><br>
        <b>‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏ß‡∏∞‡∏£‡∏ß‡∏°:</b> ${data.total}/40
      `;
    }

    // ‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö JavaScript Web Bridge
    window.addEventListener("message", (e) => {
      receiveFromThunkable(e.data);
    });
  </script>

</body>
</html>