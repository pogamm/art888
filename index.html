<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Daily Health Insight</title>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
  body {
    margin: 0;
    padding: 16px;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    background: #f4f6fb;
  }

  .card {
    max-width: 580px;
    margin: auto;
    background: #ffffff;
    border-radius: 18px;
    padding: 16px;
    box-shadow: 0 10px 25px rgba(0,0,0,.08);
  }

  h2 {
    text-align: center;
    margin-bottom: 12px;
    font-size: 18px;
    color: #111827;
  }

  canvas {
    width: 100% !important;
    height: 220px !important;
  }

  .section {
    margin-top: 14px;
    padding: 14px;
    border-radius: 14px;
    font-size: 14px;
    line-height: 1.7;
  }

  .overall { background: #f9fafb; color: #111827; }
  .detail  { background: #eef2ff; color: #1e3a8a; }
  .plan    { background: #ecfeff; color: #155e75; }

  .title {
    font-weight: 700;
    margin-bottom: 6px;
  }
</style>
</head>

<body>

<div class="card">
  <h2>สรุปสุขภาพประจำวัน</h2>

  <canvas id="chart"></canvas>

  <div id="overall" class="section overall"></div>
  <div id="detail" class="section detail"></div>
  <div id="plan" class="section plan"></div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  setTimeout(() => {

    // ===============================
    // 1️⃣ รับค่าจาก Thunkable
    // ===============================
    const params = new URLSearchParams(window.location.search);
    const energy = Number(params.get("a")) || 0;
    const mind   = Number(params.get("b")) || 0;
    const focus  = Number(params.get("c")) || 0;
    const life   = Number(params.get("d")) || 0;

    const values = [energy, mind, focus, life];
    const labels = ["Energy", "Mind", "Focus", "Life"];
    const avg = values.reduce((a,b)=>a+b,0) / values.length;

    // ===============================
    // 2️⃣ กราฟ
    // ===============================
    const ctx = document.getElementById("chart").getContext("2d");
    new Chart(ctx, {
      type: "bar",
      data: {
        labels,
        datasets: [{
          data: values,
          backgroundColor: ["#60A5FA","#34D399","#A78BFA","#FB923C"],
          borderRadius: 12
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { display: false } },
        scales: { y: { beginAtZero: true, max: 10 } }
      }
    });

    // ===============================
    // 3️⃣ ภาพรวม (หมอประเมิน)
    // ===============================
    const overall = document.getElementById("overall");

    if (avg <= 3) {
      overall.innerHTML = `
        <div class="title">ภาพรวมสุขภาพวันนี้</div>
        วันนี้ร่างกายและจิตใจอยู่ในภาวะอ่อนล้าค่อนข้างชัดเจน
        ไม่เหมาะกับการฝืนหรือเร่งตัวเอง
        ควรให้ความสำคัญกับการพักและลดภาระที่ไม่จำเป็น
      `;
    } else if (avg <= 6) {
      overall.innerHTML = `
        <div class="title">ภาพรวมสุขภาพวันนี้</div>
        สุขภาพโดยรวมอยู่ในระดับปานกลาง
        ยังใช้ชีวิตประจำวันได้ แต่พลังงานมีจำกัด
        การจัดลำดับความสำคัญจะช่วยให้วันผ่านไปได้ดีขึ้น
      `;
    } else {
      overall.innerHTML = `
        <div class="title">ภาพรวมสุขภาพวันนี้</div>
        วันนี้ร่างกายและจิตใจมีความพร้อมค่อนข้างดี
        แสดงถึงการดูแลตัวเองที่เหมาะสม
        หากรักษาพฤติกรรมนี้ไว้ จะช่วยเสริมความมั่นคงในระยะยาว
      `;
    }

    // ===============================
    // 4️⃣ วิเคราะห์รายด้าน
    // ===============================
    const detail = document.getElementById("detail");

    function analyze(name, value, low, mid, high) {
      if (value <= 3) return `<b>${name}:</b> ${low}<br>`;
      if (value <= 6) return `<b>${name}:</b> ${mid}<br>`;
      return `<b>${name}:</b> ${high}<br>`;
    }

    detail.innerHTML = `
      <div class="title">วิเคราะห์รายด้าน</div>
      ${analyze("พลังงานร่างกาย (Energy)", energy,
        "ร่างกายอาจพักผ่อนไม่เพียงพอ หรือใช้พลังงานเกินขีดจำกัด",
        "พลังงานพอใช้ แต่ควรบริหารให้เหมาะสม",
        "ร่างกายแข็งแรง สดชื่น")}
      ${analyze("สภาพจิตใจ (Mind)", mind,
        "อาจมีความเครียดหรือแรงกดดันสะสม",
        "จิตใจค่อนข้างคงที่ แต่ยังมีความกังวล",
        "จิตใจปลอดโปร่ง อารมณ์มั่นคง")}
      ${analyze("สมาธิ (Focus)", focus,
        "สมาธิหลุดง่าย อาจเหนื่อยล้าทางความคิด",
        "โฟกัสได้เป็นช่วง ๆ",
        "มีสมาธิดี เหมาะกับงานที่ใช้ความคิด")}
      ${analyze("สมดุลชีวิต (Life)", life,
        "ชีวิตอาจเสียสมดุลระหว่างงานและการพัก",
        "สมดุลพอใช้ แต่ยังจัดเวลาได้ดีกว่านี้",
        "สมดุลชีวิตดี ดูแลตัวเองเหมาะสม")}
    `;

    // ===============================
    // 5️⃣ คำแนะนำแบบไม่ซ้ำ (หัวใจหลัก)
    // ===============================
    const plan = document.getElementById("plan");

    const lowCount  = values.filter(v => v <= 3).length;
    const midCount  = values.filter(v => v >= 4 && v <= 6).length;
    const highCount = values.filter(v => v >= 7).length;

    let text = "";

    // รูปแบบคะแนน
    if (lowCount >= 2) {
      text += "วันนี้มีหลายด้านที่คะแนนอยู่ในระดับต่ำ "
           + "สะท้อนถึงความอ่อนล้าสะสมทั้งทางร่างกายและจิตใจ ";
    } else if (highCount >= 3) {
      text += "วันนี้หลายด้านของคุณอยู่ในระดับที่ดี "
           + "แสดงถึงความพร้อมและความสมดุลที่ค่อนข้างชัดเจน ";
    } else {
      text += "วันนี้สุขภาพของคุณอยู่ในลักษณะผสม "
           + "มีทั้งจุดแข็งและจุดที่ควรดูแลเพิ่มเติม ";
    }

    // ความสัมพันธ์ของคะแนน
    if (energy <= 3 && focus <= 4) {
      text += "รูปแบบคะแนนบ่งชี้ถึงความล้าทางร่างกายที่ส่งผลต่อสมาธิ ";
    }
    if (mind <= 3 && life <= 4) {
      text += "จิตใจและสมดุลชีวิตอาจกำลังถูกกดดันพร้อมกัน ";
    }
    if (energy >= 7 && life <= 4) {
      text += "แม้ร่างกายยังมีพลัง แต่รูปแบบการใช้ชีวิตอาจหนักเกินไป ";
    }

    text += "<br><br><b>แนวทางดูแลตัวเองวันนี้:</b><br>";

    if (energy <= 3) text += "• ลดกิจกรรมที่ใช้แรง และให้ความสำคัญกับการพักร่างกาย<br>";
    if (mind <= 3)   text += "• หลีกเลี่ยงความเครียดที่ไม่จำเป็น และดูแลอารมณ์เป็นพิเศษ<br>";
    if (focus <= 3)  text += "• ทำงานทีละอย่าง และลดสิ่งรบกวนรอบตัว<br>";
    if (life <= 3)   text += "• ปรับตารางชีวิตให้มีเวลาส่วนตัวมากขึ้น<br>";
    if (highCount >= 3) text += "• รักษาพฤติกรรมที่ดีในวันนี้ไว้ให้ต่อเนื่อง<br>";

    plan.innerHTML = `
      <div class="title">คำแนะนำเฉพาะของคุณวันนี้</div>
      ${text}
    `;

  }, 300);
});
</script>

</body>
</html>